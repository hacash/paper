Hacash：一种大规模支付即时清算的点对点金融货币系统
===

【摘要】
---

本文提出了一种运用通道链有序多签名实时冲销结算方法，可无上限扩充每秒交易量，能掠夺性惩罚不诚实一方从而确保资金安全和实时到账的点对点现代电子货币发行支付体系。内建多重签名地址和层级股权控制地址、多方签署交易结构、全类别支付协议及资产变更协议，满足现代金融、企业及个人的绝大部分支付需求。结合了资金抵押、工作量证明及运气值的抢占式记账权奖励分配方式，能有效规避双重支付、防范算力攻击和降低马太效应。并采取符合经济规律的货币增量发行算法、分布式交易挖矿以及区块钻石等激励机制，无需授权信任或期望寄托于任何机构即可维护整个系统的长期有效运转。

通道链清算网络的基本原理是：每两个账号各自锁定若干资金，组成一个支付通道，私下高频多次支付并双方签名，期间无需向全网广播交易，只需最后一次向主网广播最终的余额分配即可取回各自正确拥有的资金，从而极大地扩充整个系统的每秒交易数量；如果单方结束通道，则其资金会被锁定一段时间，如果另一方在此期间内向主网举证更加新的余额分配从而证实对方作假欺诈，则揭露方将会夺取对方全部资金，从而迫使双方保持诚实；只需将多个支付通道连接起来，并从收款方开始让所有资金流转方有序签名直至付款者最终签署，则所有相关方将同时收到和付出资金，从而确保支付完整和资金安全；通道可收取微量手续费激励其提供稳定服务。

目录
---

一、前言
  1. 危机
  2. 货币的未来
  3. 我们需要什么

二、基本原理
  1. 技术理论
  2. 自利原则
  3. 不足

三、通道链清算网络
  1. 横向扩容不可行
  2. 不安全的纵向层级扩容
  3. 自利原则仲裁保护
  4. 主要技术原理
  5. 去中心化原则
  6. 算法及数据结构

四、交易结构
  1. 为何不用智能合约
  2. 基本数据结构
  3. 多重签名地址
  4. 层级股权控制地址
  5. 多方签署
  6. 支付类别
  7. 签名剥离
  8. 手续费动态竞价
  9. 统一标准协议

五、激励
  1. 货币发行算法
  2. 记账权竞争奖励
  3. 交易挖矿
  4. 手续费
  5. 区块钻石
  6. 数据服务

六、隐私
  1. 匿名
  2. 交易混搅服务
  3. 通道冲销

七、设计原则
  1. 简单直观
  2. 执行高效
  3. 数据紧凑
  4. 主链数据保持精简且增长可预估
  5. 可剥离及压缩
  6. 统一协议标准

八、缺陷与风险
  1. 通道链延迟签名攻击
  2. 无成本通道违约
  3. 算力集中化
  4. 价格极端波动难以作为结算单位

九、结论

十、附录
  1. 参考引用
  2. 完整区块数据结构定义及注释
  3. 相关算法代码


---

一、前言
---

### 1. 危机

我们走到了货币体系变革的时代关口。

纵观历史，文明发展和经济进步总伴随一个前提：文化和金融自由。无论资本主义还是社会主义，无论发达国家还是发展中国家，周期性出现的经济危机却让人们对金融体系施行更加严厉管制的呼声越来越高。究其本源，不同的现代社会经济体制都有一个共同点：强制性主权信用货币和银行部分准备金制度。这本质上是一种欺诈，是金融不稳定的根源，是除暴力掠夺之外导致利益分配不公的最大缘由。随之必然而来的经济干预政策极尽推波助澜或矫枉过正，如同王朝更迭一样反复伤害原本该渐进增长的经济体和人们的生活水平。

不稳定、不可预期、人为肆意干预和操控的金融环境，将使得大型资本在根本不必进入实体经济的情况下即可轻松获得超额增值。当资本特别是巨型资本的回报率超过甚至远超长期整体经济发展的平均回报水平时，贫富差距就会不可避免的地加速拉大，直至社会矛盾加剧、经济危机和动乱。如果某一代人刚好在长达十年甚至二十年的大萧条起始时成年，那么他们的命运将注定艰难困苦、碌碌无为。这非常不公平，为何前一代人的贪婪、愚蠢和疯狂，却要下一代来承担后果？为了抹平这种周期性危机导致的严重代际不公（或许因此带来更严重的社会动乱、革命甚至战争），采取经济干预和刺激政策，注入兴奋剂成了一个痛苦的权宜之计。不过，面对不利的人口与债务趋势，不可能通过短期的刺激手段应对长期的结构性危机，这根本就是在自欺欺人。

如果，我们能够从根本上解决问题，避免或大幅减少金融危机和经济崩溃呢？

中国北宋时由于政府在四川地区强制使用铁质钱币造成的笨重不便，民间出现了原始的纸币：交子，这似乎是一种货币金融的“进步”。当时的政权发现这简直是完美的税收工具，随即将纸币发行权收归国有，不用再耗费大量财力物力丈量土地、清点户籍、收钱造册，只需轻轻开动印刷机，就能悄无声息源源不断地从民间抽取大量财富。但随之而来的反复超级通货膨胀和经济崩溃打破了王朝的如意算盘，终于在明代初年间人们彻底不再相信任何纸片，退回到了贵金属货币时代，甚至大家直接通过分割和称重散碎银两来进行交易。这种看起来像退化到了原始的货币状态却给了民间极大的金融和经济自由度，成就了中国历史上少有的金融稳定时期，普通百姓生活水平得到提升，这种情况一直持续到清朝后期。

货币来源于市场，并终将服务于市场。其形态本身并没有高低极之分，也没有绝对的好与坏，只有是否更加适应及高效。我们需要一个自由竞争、适者生存的货币市场和开放透明、避免欺诈的金融环境。这个世界上的不公本质上是信息的不公。

### 2. 货币的未来

黄金本是地球上最适合成为货币的物品，但是人们现在却没有使用它进行大规模的交易支付。主要原因有：1. 笨重不便于携带；2. 不可无限分割用于小额支付；3. 长期流通造成磨损耗费；4. 造假掺假技术越发强大。请注意，储量有限并不是它的缺点。在欧洲历史上曾长期使用黄金作为储备的纸币进行流通，这种方式表面上兼具黄金的优点却规避了其作为日常支付手段的缺陷。只不过，没有任何个人和组织禁得住凭空创造钱的诱惑，无论承诺多么坚决，纸币总是会被超发。与历史上在金、银、铜币里掺杂其他金属故意造成贬值的情况别无二致，甚至由于发行成本的极度降低造成严重通货膨胀从而导致经济的崩溃。这种情况曾反复多次出现。

阻止黄金作为通用支付手段的另外两大具备争议的问题是：1. 储量位置分布不均，地下有金矿的国家相当于坐收全世界的税；2. 无法在经济的增长率和规模大幅变动之时快速调节供应量，容易造成紧缩和钱荒。特别是关于第2点的争论已大量见于奥地利、现代货币和凯恩斯等各个经济学派的著作之中，其中一些认为信用扩张是经济危机的根源、是洪水猛兽，而另一些则坚定认为没有“弹性”的货币将会锁死整个经济的发展。

历史上，货币大致经历了如下几个种类或阶段（并不代表出现的先后顺序或本质优劣）：

	1. 通用价值物（谷物、布帛、牛羊、香烟等）
	2. 稀有稳态物（金、银、铜、宝石、贝壳等）
	3. 信托账务凭证（存款证明、债务凭证、匿名支票、商品券、纸黄金等）
	4. 主权信用符号（法币）

其中第1、2阶段由于无法满足现代商业支付需要而被逐渐淘汰，第3阶段似乎会造成信用膨胀和银行家欺诈带来的经济脆弱及崩溃，人们随即期望政府设立的央行机构体系解决问题（或者更有利于政府），于是走入了第4个阶段，但效果如大家所见，并不遂人意。

我们认为，货币的未来，也就是第5阶段的形态将会是「公认规则」为主体、骨干，「个体信用」为分支、补充的开放性电子网络体系，并且会在自由竞争的过程中持续改进和显现出最优的系统。这种「公认规则」不以任何人的意志、权力为转移，不受任何机构的控制，就像没有人能够凭空创造出黄金一样，公平的规则能让全世界有效的参与进来。

2008年，比特币（Bitcoin）以及背后区块链技术的出现和十年来的有效运转为我们指明了方向。

### 3. 我们需要什么

区块链的核心价值并不在去中心化，也不在永久保存数据，更不在逃避监管，而是在于去信任化。

比特币的出现并不是为了提升局部暂时支付效率或者减少部分瞬时交易成本，而是为了避免或降低辜负我们信任的企业与机构作恶的后果。它的愿景是完全匿名与去中心点对点信任，而区块链的未来则是公开透明与分布式自审计信任。

正如互联网满足了人类信息通讯的基础需要一样，区块链是为了解决困扰人类几十万年的大问题：欺诈。我们历史上为此付出了巨大成本，消耗了无数资源，阻断了太多交易。所以我们不能在未来的货币体系中加入任何欺诈的可能性，上帝保证也不行。

我们需要一种货币，没有人能肆意降低它的成色，可以更好的维护经济系统的稳定发展，并且完全能满足现代商业支付、企业财账及金融清算的需要。


二、基本原理
---

### 1. 技术理论

货币需要相对的稀有排他性，没有人会把水、土壤或者树叶作为交易媒介。然而在电子信息世界里，一切都是可几乎无成本复制。那么以二进制数据为载体的货币就有着一个致命的本质缺陷：数量无限且真假难辨。如果我们仍然依赖一个在线发行机构或电子造币厂确保钱币的真实有效和数量上限，那么从历史经验来看，没有谁能忍受凭空创造钱的诱惑，最终大家手里的东西将会一文不值。

一种直观就能想到的解决方案是将每一枚电子货币都编上整数号码，并公布一个号码的上限（或者这个上限每年自动增长固定数额），然后用电子签名的方式标注上每一枚货币的拥有者（先忽略谁最先拥有这些货币的问题），然后每一枚货币在支付的同时，都将由当前拥有者用私钥签名接收者的公钥，表明此枚钱币已经支付给对方，并保留所有历史支付记录。如此则解决了电子货币复制造假和数量无限的问题。

但是上文提出的方案有几个显而易见的缺陷：

    1. 不能被分割用作小额支付或找零；
    2. 同一枚钱币可被同一时间支付给不同的两个人甚至更多人（双花）；

缺陷1可以用足够小额的面值（编号上限足够大）来解决。而双花问题则比较麻烦，一种办法是让一个公共的中心机构来保存及证明每一笔支付的记录，但却仍然依赖机构负责人的正直诚信，且其有被迫欺诈的可能。另一种办法是通过广播，让所有人都各自拥有一份账本，列出所有人每一笔支付的记录，当接收钱币时即在自己的账本上查询钱币的拥有者，以此避免双花。

每个人都有一份账本的方案看似解决了双花问题，但仍然具备很大的缺陷：

    1. 维护一套账本不间断记录所有支付是需要耗费很大成本的，不经常收到钱币的个人实时维护一整套账本显然得不偿失。最后大家还是会依赖一些大的类似银行的机构出具的账本。
    2. 当有一些支付因为广播的技术原因并未到达所有账本记录者（比如海底光缆被切断），大家各自的账本记录就会不一致。长时间便会形成大量的不同版本，大家彼此不相认同，最终支付体系崩溃。
    3. 如果每个人花费很大成本维护账本只是为了自己在收钱时查询有效性，那么这种货币系统未免太过低效，并且最终会因为搭便车问题导致账本无人维护。

当然，还有一个最为关键的问题：谁应该最先拥有这些电子货币？

### 2. 自利原则

长期来看，任何单方面寄希望于对方的正直诚实和信守承诺，而没有其他激励和制衡的合作体系，终将不可持续。

而不断地有效运转的社会合作系统，无一不是正确面对人性的贪婪和自利，并加以利用让其用于维护体系的自我运行。比特币走在了正确的道路上并于期十年的发展中越发壮大。它通过创造性地将账本记录和货币发行两者结合起来，为大家维护账本提供了充足的动机，并采取工作量证明竞争记账权的方式让所有人的账本始终保持统一，从而巧妙的解决了上文所面临缺陷。当然它也并没有使用为每一枚钱币编码的体系，而采用了未花费余额（UTXO）的方式支持小额支付和找零。关于比特币的详细理论这里并不过多介绍，大家请参阅中本聪的论文。

### 3. 不足

可天下没有免费的午餐，也并无完美无暇的碧玉。正如我们上文一直以来的“提出问题-解决问题-遇到新问题”的推导一样，公开竞争记账的货币体系仍然有两个大家所诟病的缺点：

    1. 通过哈希算法重复运算竞争一定时间内的账目记录权从而获得增发的货币奖励的方式耗费了大量的硬件及能源。
    2. 由于需要向所有账本记录人广播每一笔支付并得到确认，导致总体支付效率非常低下（大约每秒7笔），并且需要支付高昂的手续费，根本无法满足现代商业的需要。

严格来说，我们并不认为第1点是真正的缺点。除了短期内的投机和非理性繁荣，在一个没有强制性的自由竞争领域，大家总会找到一个成本和收益的平衡点，我们使用了大量能源和精力，并不是因为我们疯了，而是这样做总体上有利可图，耗费的成本终将在其它方面更多的补偿回来。正如我们并没有用尽全力把地球上所有的石油和黄金全部都开采出来一样，因为这么做不经济。

可暂时延缓第2个缺点最直观的办法是扩容，即扩充区块大小上限或减少区块生成间隔时间，但这无法从根本上解决问题。区块大小具备理论上限，数量太大会加长下载传输同步的时间，这进一步限制了区块间隔时间的上限。这是一个水涨船高的过程，新的交易总会填满扩充的空间，而全世界的交易支付量远大于当前受硬件体系制约的扩容理论上限。

另一种某些改进者正在尝试的方案是：极度缩减账本记录者的总数量（比如21个或101个），对他们的工具性能提出比较高的要求，并将新增钱币给予他们以此鼓励，整个系统便能承载很大的交易量。这看起来令人欢欣鼓舞，然而如上文所说，这种形式有它不可规避的缺点，其与历史上的铸币厂分局体系无本质区别。

参照显示世界的运转，成年健壮男子可轻松抢夺街上妇女儿童的财货占为己有，可多数人并没有这么做，是因为大家知道，背后的警察和法律体系将让其付出更大的代价，从而让这种作恶行为得不偿失。事实证明，就算存在风险，只要具备严格的惩罚机制，大家的理性驱利行为将维持系统总体的有效运行。

我们提出，公共账本不应该包含全部的交易支付记录，而应该作为一个严格准确有效且不能被操控的仲裁体系，保证在私下进行的支付行为不能欺诈，否则即给予严厉的惩罚。这种体系能极大的动态按需增加交易量，并在理论上没有上限，从而能完全应对现代商业发展的需要。


三、通道链清算网络
---


  1. 横向扩容不可行
  2. 不安全的纵向层级扩容
  3. 自利原则仲裁保护
  4. 主要技术原理
  5. 去中心化原则
  6. 算法及数据结构
























