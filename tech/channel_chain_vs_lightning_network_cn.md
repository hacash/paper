通道链网络、闪电网络技术点对比
===

Hacash 白皮书名为《一种大规模支付实时结算的加密货币系统》，其很大部分篇幅都在描述原创的“通道链支付结算网络”的机制原理和技术实现，论证其“大规模支付实时结算”的技术创新。但白皮书的论述比较繁复、缺乏成体系的提炼，难以清晰理解技术重点。本文档将通过与同属状态通道技术的比特币闪电网络技术的各方面异同点对比，来更加简明扼要的直接展现“通道链”技术的优劣、特点，以供大家参考。

对比将分为相同点和不同点两个部分。

## 相同点对比

#### 1. 状态通道

Hacash的通道链网络和比特币的闪电网络，本质来讲都是 Layer2 技术，同属状态通道技术大类，基本原理都是将区块链主网当做仲裁保证，通过通道双方的对等博弈来支持海量链下支付的安全性，且无需等待能实时到账。只是在具体技术实现方面有区别。

#### 2. 主网开启和关闭通道

两者都需要支付些许gas费通过一笔交易在主网上开启通道，才能使用支付功能。

#### 3. 存入代币

类似于银行存款账户，都需要通道双方存入一定量代币，才能支付。

#### 4. 仲裁挑战期

单方面关闭通道时，都需要一定时间（几小时到几天、几周不等）来作为仲裁等待期，以确定提请关闭方没有作恶（拿走通道中本不属于自己的代币）。

#### 5. 多跳支付

如果每个人都要和每个发生转账的人都开启一个通道，这将导致难以想象的麻烦和成本。解决这个问题的方案是通过中间人进行多跳支付： A 与 B 开启了通道、B 与 C 开启了通道，那么 A 想要转账给 C 并不需要 A 与 C 之间开启通道，只需要 A 支付给 B 后 B 再支付给 C 即可。

#### 6. 节点服务商

因为多跳支付需求的存在，就会存在专门针对于此“中间人”需求的节点服务商。这些服务商会处理大量的“中间人支付”，同时收取很少量（与主网相比较）的服务费来保持运营。这些服务商将成为技术意义上的银行，这些“银行”之间也会开设清算通道，普通用户只需要在一个这样的“银行”里开启通道，理论上就可以把前支付给其他任何同样有“银行账户”的人。

#### 7. 支付路由

通道数量增长到大规模之后，多跳支付使用的中间节点就变得不那么一目了然，需要程序来查找。这时就需要像 IP 地址路由一样的“支付通道路由器”或者“支付路由联盟”，来帮助用户和节点知晓全球任意两个人之间的支付需要通过哪些“中间人”。

#### 8. 收款容量问题

通道由双方开启，你能收到的代币数量上限，就是对方的存款额，另一方来说也是如此。如果由专业的节点服务商来和用户开启通道，那么这些服务商将为每个人都存入一定数量代币，才能让用户收到钱。如果用户收款数量超过了对方存入的数额，那么这笔交易将无法处理。

#### 9. 对账凭据

每次支付过后，都需要保存和备份还支付产生的凭据，这将是你在通道内拥有余额的证明，丢失凭据则可能会丢钱。

#### 10. 隐私泄露

你的通道服务商将能够知晓你的所有交易。


## 不同点对比

#### 1. 同步支付 VS 异步支付

对于多跳支付来说，通道链采用实时同步支付，而闪电网络采用异步支付。同步支付的安全性更有保证，你的支付要么完全成功，要么完全失败，不会有中间状态。而闪电网络的异步支付方式，可能会出现你支付给你的节点服务商，而他却没有把你的钱给你的目标收款人的收款人情况，出现未完成状态的支付。简要来说，闪电网络的中间人有可能、有能力扣下你的钱，而通道链网络从技术上完全排除了这种可能。

#### 2. 支付路由联盟

通道链网络的实时同步支付方式，更加依赖节点服务商的及时响应。这就需要一个时常更新保持有效性的路由表。节点之间可能会搭建一个非盈利性的路由联盟，类似于传统互联网的域名路由服务（DNS）。而闪电网络更可能采用效率更低但相比更去中心化的路由方式。

#### 3. 信用透支

通道链内的余额支持负值，这给节点服务商授信给用户透支额度（类似信用卡）创造了可能性。信用可以是双向的：服务商给用户授信，用户也可以反过来给服务商授信。

#### 4. 服务商快速通道

节点服务商与服务商之间由于要处理巨大的客户支付需求，它们将可能采取一种“延后批量对账”的方式来应对。简要来说就是不在每一笔支付后立即对账，而是累计支付到 10 笔、100笔甚至更多支付之后，再一次性对账。这有助于提升支付处理效率。

#### 5. 收付平账

Hacash白皮书内有描述在付款通道和收款通道分离的情况下，通道链网络支持一种收款和付款的原子化平账操作，就是将收款通道内累积的货币余额一次性快速转移到支付通道。类似从工资账户划转到消费账户。

#### 6. 去中心化

通道链网络由于其同步支付等技术特性，将使得其整体的去中心化程度要高于闪电网络。闪电网络在异步支付特性，将可能导致节点服务商寡头垄断市场甚至一家独大的问题。去中心化不复存在。

#### 7. 链上交互

通过可读金融合约，通道链的有关处理，可以直接在Hacash链上进行交互和组合。例如可以在一个合约内，向服务商支付服务费用且开通一个新的通道。

#### 8. 容量扩展

通过链上交互，就可以在不关闭通道的情况下，再次向通道存入代币，来扩展通道的支付或收款容量，解决上文提到的容量问题。

#### 9. 凭据备份

由于 UTXO 技术的限制，闪电网络需要备份所有历史支付的产生的每一笔凭证，才能够保证通道余额是安全的，这带来了极大的不便和空间占用。而通道链网络只需要保存最后一笔支付的对账数据即可，历史可以直接丢弃。

#### 10. 技术架构

Hacash 的可读金融合约相比于比特币的 UTXO 交易结构更加灵活和成熟，在可扩展性和金融操作便捷性上都更加强大。这给通道链支付技术带来了更多的可能性，可以满足更丰富的支付需求。

#### 11. 支持币种

闪电网络仅支持比特币。通道链网络支持 HAC 和 BTC 支付，且支持两者同时支付。未来将可能将通道链支付技术应用到 Hacash L3 多链多层扩容基础设施上，支持更多币种的实时支付需求。